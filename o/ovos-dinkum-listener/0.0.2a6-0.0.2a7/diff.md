# Comparing `tmp/ovos_dinkum_listener-0.0.2a6-py3-none-any.whl.zip` & `tmp/ovos_dinkum_listener-0.0.2a7-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,16 +1,16 @@
-Zip file size: 20950 bytes, number of entries: 14
--rw-r--r--  2.0 unx      578 b- defN 23-Apr-23 00:25 ovos_dinkum_listener/__init__.py
--rw-r--r--  2.0 unx    26500 b- defN 23-Apr-23 00:25 ovos_dinkum_listener/__main__.py
--rw-r--r--  2.0 unx     2209 b- defN 23-Apr-23 00:25 ovos_dinkum_listener/plugins.py
--rw-r--r--  2.0 unx     4739 b- defN 23-Apr-23 00:25 ovos_dinkum_listener/transformers.py
--rw-r--r--  2.0 unx      114 b- defN 23-Apr-23 00:25 ovos_dinkum_listener/version.py
--rw-r--r--  2.0 unx      752 b- defN 23-Apr-23 00:25 ovos_dinkum_listener/voice_loop/__init__.py
--rw-r--r--  2.0 unx     8686 b- defN 23-Apr-23 00:25 ovos_dinkum_listener/voice_loop/hotwords.py
--rw-r--r--  2.0 unx     4630 b- defN 23-Apr-23 00:25 ovos_dinkum_listener/voice_loop/microphone.py
--rw-r--r--  2.0 unx    17427 b- defN 23-Apr-23 00:25 ovos_dinkum_listener/voice_loop/voice_loop.py
--rw-r--r--  2.0 unx      601 b- defN 23-Apr-23 00:25 ovos_dinkum_listener-0.0.2a6.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Apr-23 00:25 ovos_dinkum_listener-0.0.2a6.dist-info/WHEEL
--rw-r--r--  2.0 unx       77 b- defN 23-Apr-23 00:25 ovos_dinkum_listener-0.0.2a6.dist-info/entry_points.txt
--rw-r--r--  2.0 unx       21 b- defN 23-Apr-23 00:25 ovos_dinkum_listener-0.0.2a6.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     1317 b- defN 23-Apr-23 00:25 ovos_dinkum_listener-0.0.2a6.dist-info/RECORD
-14 files, 67743 bytes uncompressed, 18702 bytes compressed:  72.4%
+Zip file size: 21189 bytes, number of entries: 14
+-rw-r--r--  2.0 unx      578 b- defN 23-Apr-23 00:49 ovos_dinkum_listener/__init__.py
+-rw-r--r--  2.0 unx    26580 b- defN 23-Apr-23 00:49 ovos_dinkum_listener/__main__.py
+-rw-r--r--  2.0 unx     2784 b- defN 23-Apr-23 00:49 ovos_dinkum_listener/plugins.py
+-rw-r--r--  2.0 unx     4739 b- defN 23-Apr-23 00:49 ovos_dinkum_listener/transformers.py
+-rw-r--r--  2.0 unx      114 b- defN 23-Apr-23 00:49 ovos_dinkum_listener/version.py
+-rw-r--r--  2.0 unx      752 b- defN 23-Apr-23 00:49 ovos_dinkum_listener/voice_loop/__init__.py
+-rw-r--r--  2.0 unx     8686 b- defN 23-Apr-23 00:49 ovos_dinkum_listener/voice_loop/hotwords.py
+-rw-r--r--  2.0 unx     4630 b- defN 23-Apr-23 00:49 ovos_dinkum_listener/voice_loop/microphone.py
+-rw-r--r--  2.0 unx    18031 b- defN 23-Apr-23 00:49 ovos_dinkum_listener/voice_loop/voice_loop.py
+-rw-r--r--  2.0 unx      601 b- defN 23-Apr-23 00:49 ovos_dinkum_listener-0.0.2a7.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Apr-23 00:49 ovos_dinkum_listener-0.0.2a7.dist-info/WHEEL
+-rw-r--r--  2.0 unx       77 b- defN 23-Apr-23 00:49 ovos_dinkum_listener-0.0.2a7.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx       21 b- defN 23-Apr-23 00:49 ovos_dinkum_listener-0.0.2a7.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     1317 b- defN 23-Apr-23 00:49 ovos_dinkum_listener-0.0.2a7.dist-info/RECORD
+14 files, 69002 bytes uncompressed, 18941 bytes compressed:  72.6%
```

## zipnote {}

```diff
@@ -21,23 +21,23 @@
 
 Filename: ovos_dinkum_listener/voice_loop/microphone.py
 Comment: 
 
 Filename: ovos_dinkum_listener/voice_loop/voice_loop.py
 Comment: 
 
-Filename: ovos_dinkum_listener-0.0.2a6.dist-info/METADATA
+Filename: ovos_dinkum_listener-0.0.2a7.dist-info/METADATA
 Comment: 
 
-Filename: ovos_dinkum_listener-0.0.2a6.dist-info/WHEEL
+Filename: ovos_dinkum_listener-0.0.2a7.dist-info/WHEEL
 Comment: 
 
-Filename: ovos_dinkum_listener-0.0.2a6.dist-info/entry_points.txt
+Filename: ovos_dinkum_listener-0.0.2a7.dist-info/entry_points.txt
 Comment: 
 
-Filename: ovos_dinkum_listener-0.0.2a6.dist-info/top_level.txt
+Filename: ovos_dinkum_listener-0.0.2a7.dist-info/top_level.txt
 Comment: 
 
-Filename: ovos_dinkum_listener-0.0.2a6.dist-info/RECORD
+Filename: ovos_dinkum_listener-0.0.2a7.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## ovos_dinkum_listener/__main__.py

```diff
@@ -32,15 +32,15 @@
 from ovos_plugin_manager.vad import OVOSVADFactory
 from ovos_plugin_manager.vad import get_vad_configs
 from ovos_plugin_manager.wakewords import get_ww_lang_configs, get_ww_supported_langs, get_ww_module_configs
 from ovos_utils.file_utils import resolve_resource_file
 from ovos_utils.log import LOG
 from ovos_utils.sound import play_audio
 
-from ovos_dinkum_listener.plugins import load_stt_module
+from ovos_dinkum_listener.plugins import load_stt_module, load_fallback_stt
 from ovos_dinkum_listener.voice_loop import AlsaMicrophone, DinkumVoiceLoop, ListeningMode, ListeningState
 from ovos_dinkum_listener.voice_loop.hotwords import HotwordContainer
 
 # Seconds between systemd watchdog updates
 WATCHDOG_DELAY = 0.5
 
 
@@ -159,22 +159,24 @@
         )
         mic.start()
 
         hotwords = HotwordContainer(self.bus)
         hotwords.load_hotword_engines()
 
         vad = OVOSVADFactory.create()
-        stt = load_stt_module(self.config, self.bus)
+        stt = load_stt_module()
+        fallback_stt = load_fallback_stt()
 
         transformers = AudioTransformersService(self.bus, self.config)
 
         self.voice_loop = DinkumVoiceLoop(
             mic=mic,
             hotwords=hotwords,
             stt=stt,
+            fallback_stt=fallback_stt,
             vad=vad,
             transformers=transformers,
             #
             speech_seconds=listener.get("speech_begin", 0.3),
             silence_seconds=listener.get("silence_end", 0.7),
             timeout_seconds=listener.get("recording_timeout", 10),
             num_stt_rewind_chunks=listener.get("utterance_chunks_to_rewind", 2),
```

## ovos_dinkum_listener/plugins.py

```diff
@@ -39,25 +39,41 @@
             self.update(chunk)
 
     def update(self, chunk: bytes):
         self.buffer.write(chunk)
 
 
 class FakeStreamingSTT(StreamingSTT):
-    def __init__(self, config=None):
+    def __init__(self, engine, config=None):
         super().__init__(config)
-        self.engine = OVOSSTTFactory.create()
+        self.engine = engine
 
     def create_streaming_thread(self):
         listener = Configuration().get("listener", {})
         sample_rate = listener.get("sample_rate", 16000)
         sample_width = listener.get("sample_width", 2)
         return FakeStreamThread(self.queue, self.lang, self.engine, sample_rate, sample_width)
 
 
-def load_stt_module(config: Dict[str, Any], bus: MessageBusClient) -> StreamingSTT:
-    stt_config = config["stt"]
+def load_stt_module(config: Dict[str, Any] = None) -> StreamingSTT:
+    stt_config = config or Configuration()["stt"]
     plug = OVOSSTTFactory.create(stt_config)
     if not isinstance(plug, StreamingSTT):
         LOG.debug("Using FakeStreamingSTT wrapper")
-        return FakeStreamingSTT(config)
+        return FakeStreamingSTT(plug, config)
     return plug
+
+
+def load_fallback_stt(cfg: Dict[str, Any] = None) -> StreamingSTT:
+    cfg = cfg or Configuration().get("stt", {})
+    fbm = cfg.get("fallback_module")
+    if fbm:
+        try:
+            config = cfg.get(fbm, {})
+            plug = OVOSSTTFactory.create({"stt": {"module": fbm, fbm: config}})
+            if not isinstance(plug, StreamingSTT):
+                LOG.debug("Using FakeStreamingSTT wrapper")
+                return FakeStreamingSTT(plug, config)
+            return plug
+        except:
+            LOG.exception("Failed to load fallback STT")
+    return None
```

## ovos_dinkum_listener/version.py

```diff
@@ -1,6 +1,6 @@
 # START_VERSION_BLOCK
 VERSION_MAJOR = 0
 VERSION_MINOR = 0
 VERSION_BUILD = 2
-VERSION_ALPHA = 6
+VERSION_ALPHA = 7
 # END_VERSION_BLOCK
```

## ovos_dinkum_listener/voice_loop/voice_loop.py

```diff
@@ -50,14 +50,15 @@
 
 
 @dataclass
 class VoiceLoop:
     mic: Microphone
     hotwords: HotwordContainer
     stt: StreamingSTT
+    fallback_stt: StreamingSTT
     vad: VADEngine
     transformers: AudioTransformersService
 
     def start(self):
         raise NotImplementedError()
 
     def run(self):
@@ -327,14 +328,16 @@
             else:
                 # Wake word detected, begin recording voice command
                 self.state = ListeningState.BEFORE_COMMAND
                 self.speech_seconds_left = self.speech_seconds
                 self.timeout_seconds_left = self.timeout_seconds
                 self.stt_audio_bytes = bytes()
                 self.stt.stream_start()
+                if self.fallback_stt is not None:
+                    self.fallback_stt.stream_start()
 
             # Reset the VAD internal state to avoid the model getting
             # into a degenerative state where it always reports silence.
             if hasattr(self.vad, "reset"):
                 self.vad.reset()
 
             self.last_ww = time.time()
@@ -366,14 +369,16 @@
         self.transformers.feed_audio(chunk)
 
         self.stt_audio_bytes += chunk
         self.stt_chunks.append(chunk)
         while self.stt_chunks:
             stt_chunk = self.stt_chunks.popleft()
             self.stt.stream_data(stt_chunk)
+            if self.fallback_stt is not None:
+                self.fallback_stt.stream_data(stt_chunk)
 
             self.timeout_seconds_left -= self.mic.seconds_per_chunk
             if self.timeout_seconds_left <= 0:
                 # Recording has timed out
                 self.state = ListeningState.AFTER_COMMAND
                 break
 
@@ -400,14 +405,16 @@
         # Recording voice command until user stops speaking
         self.stt_audio_bytes += chunk
         self.stt_chunks.append(chunk)
         while self.stt_chunks:
             stt_chunk = self.stt_chunks.popleft()
 
             self.stt.stream_data(stt_chunk)
+            if self.fallback_stt is not None:
+                self.fallback_stt.stream_data(stt_chunk)
 
             self.timeout_seconds_left -= self.mic.seconds_per_chunk
             if self.timeout_seconds_left <= 0:
                 # Recording has timed out
                 self.state = ListeningState.AFTER_COMMAND
                 break
 
@@ -427,15 +434,24 @@
 
     def _after_cmd(self, chunk):
         # Command has ended, call transformers pipeline before STT
         chunk, stt_context = self.transformers.transform(chunk)
         LOG.debug(f"transformers metadata: {stt_context}")
 
         # get text and trigger callback
-        text = self.stt.stream_stop() or ""
+        try:
+            text = self.stt.stream_stop() or ""
+        except:
+            LOG.exception("STT failed")
+            text = ""
+
+        if not text and self.fallback_stt is not None:
+            LOG.info("Attempting fallback STT plugin")
+            text = self.fallback_stt.stream_stop() or ""
+
         # TODO - some plugins return list of transcripts some just text
         # standardize support for this
         if isinstance(text, list):
             text = text[0]
         stt_context["transcription"] = text
 
         # Voice command has finished recording
```

## Comparing `ovos_dinkum_listener-0.0.2a6.dist-info/METADATA` & `ovos_dinkum_listener-0.0.2a7.dist-info/METADATA`

 * *Files 17% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: ovos-dinkum-listener
-Version: 0.0.2a6
+Version: 0.0.2a7
 Summary: ovos-core listener daemon client
 Home-page: https://github.com/OpenVoiceOS/ovos-dinkum-listener
 Author: UNKNOWN
 Author-email: UNKNOWN
 License: Apache-2.0
 Platform: UNKNOWN
 Classifier: Development Status :: 4 - Beta
```

## Comparing `ovos_dinkum_listener-0.0.2a6.dist-info/RECORD` & `ovos_dinkum_listener-0.0.2a7.dist-info/RECORD`

 * *Files 15% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 ovos_dinkum_listener/__init__.py,sha256=r7b_VnzNxUlouVBl9ZzWQEOf_cUZbIpsxmO3MRb1UPw,578
-ovos_dinkum_listener/__main__.py,sha256=TxPyLY0if4Nj3g45MB-f9kE-fu4Ox5WlDReoZNNyRXs,26500
-ovos_dinkum_listener/plugins.py,sha256=3iwEQu_h7tBcyI9WvFgeSttdd1V4jWL8rqES5_pdb1w,2209
+ovos_dinkum_listener/__main__.py,sha256=E3nq_B2bl9QOa_XYjv1f-lta2BHMwgUCyu_4syEquuo,26580
+ovos_dinkum_listener/plugins.py,sha256=66VbChNv7aYfTupjJPSSsUpURouJEqe8kB39Tc044BU,2784
 ovos_dinkum_listener/transformers.py,sha256=5Wpm5Rhvq4wbtLUXsm77w0Lw3WLyBW1Y1D8O9DFPoCw,4739
-ovos_dinkum_listener/version.py,sha256=5ZMnJBYVn7ok0sPHApedKnn86PEdwcM7A2tLSGN7Xb0,114
+ovos_dinkum_listener/version.py,sha256=4zcwvBvMyToDkX2VjKVkHS92qazmzfB8ci7G1PEJAl0,114
 ovos_dinkum_listener/voice_loop/__init__.py,sha256=NzyEEXTd__e-GJFm8QUIEonvEvg7QzpuQpfY7mqgH-4,752
 ovos_dinkum_listener/voice_loop/hotwords.py,sha256=oXEAs7w2dzrihtEgnUnwf431ZoXPBsfl_rN-QPqlLMc,8686
 ovos_dinkum_listener/voice_loop/microphone.py,sha256=VflrED1KgVMl8uHs06r8tDYAnM96ZAGf2Dwe4NXmNY0,4630
-ovos_dinkum_listener/voice_loop/voice_loop.py,sha256=WfUvsB7AatccjbujzkCE_VSugvxjOk9rLNszVhKXmME,17427
-ovos_dinkum_listener-0.0.2a6.dist-info/METADATA,sha256=ZCI_Ibu8YOPTvK1jdv-pR-L0PmVXm4h7XfX40Vyv0tc,601
-ovos_dinkum_listener-0.0.2a6.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-ovos_dinkum_listener-0.0.2a6.dist-info/entry_points.txt,sha256=QxX9kfcgIv06kWrvw4J4HBy4FmwznYh_Rz62cfJsykU,77
-ovos_dinkum_listener-0.0.2a6.dist-info/top_level.txt,sha256=MjTsTEdTQvhrDhMJlKgTxNGa_tm3Tei5ETek1JiIyx4,21
-ovos_dinkum_listener-0.0.2a6.dist-info/RECORD,,
+ovos_dinkum_listener/voice_loop/voice_loop.py,sha256=NE9_aMYgMCVO0z-sf7GS0N__5BD7RsgpNQQlf2IG3vw,18031
+ovos_dinkum_listener-0.0.2a7.dist-info/METADATA,sha256=EYlWvcwKPaA7e5hS8jGh8IuIW-Q5eEEOjh4V8VSNIt4,601
+ovos_dinkum_listener-0.0.2a7.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+ovos_dinkum_listener-0.0.2a7.dist-info/entry_points.txt,sha256=QxX9kfcgIv06kWrvw4J4HBy4FmwznYh_Rz62cfJsykU,77
+ovos_dinkum_listener-0.0.2a7.dist-info/top_level.txt,sha256=MjTsTEdTQvhrDhMJlKgTxNGa_tm3Tei5ETek1JiIyx4,21
+ovos_dinkum_listener-0.0.2a7.dist-info/RECORD,,
```

